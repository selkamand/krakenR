% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/KrakenParsing.R
\name{collapse_taxonomy_to_ranks}
\alias{collapse_taxonomy_to_ranks}
\title{Collapse a Taxonomy Graph to Selected Ranks}
\usage{
collapse_taxonomy_to_ranks(
  g,
  valid_ranks,
  taxid_attr = "name",
  rank_attr = "Rank"
)
}
\arguments{
\item{g}{A directed \code{igraph} object representing a taxonomy. Vertices
must have a rank attribute (default: \code{"rank"}), and vertex names
(\code{V(g)$name}) are treated as taxonomic IDs.}

\item{valid_ranks}{A character vector of ranks to retain (e.g. \code{c("S","F")}).
Only these vertices remain in the reduced graph.}

\item{rank_attr}{Name of the vertex attribute storing taxonomic rank codes
(default \code{"rank"}).}

\item{name_attr}{Name of the vertex attribute storing taxids (default \code{"name"}).}
}
\value{
A reduced \code{igraph} object containing:
\itemize{
\item only vertices with ranks in \code{valid_ranks},
\item edges representing direct relationships between nearest retained ancestors,
\item vertex attributes copied from the original graph,
\item edge attributes \code{parent_taxid} and \code{child_taxid}.
}
}
\description{
Given a full taxonomy stored as a directed \code{igraph} where edges point
\emph{parent → child}, this function constructs a reduced taxonomy graph
containing only vertices whose rank is in \code{valid_ranks}. Intermediate
vertices (those with ranks not in \code{valid_ranks}) are removed and their
structural role is preserved by connecting each retained vertex directly to
its nearest retained ancestor.
}
\details{
This effectively creates a "rank-skeletonized" taxonomy: a smaller graph
that preserves ancestor–descendant relationships among selected ranks.

The algorithm assumes the taxonomy is a tree or forest (each vertex has at
most one parent). It works in \eqn{O(V + E)} time and is suitable for large
taxonomies such as NCBI.

Steps:
\enumerate{
\item Identify all vertices whose rank is in \code{valid_ranks}.
\item For each vertex, precompute its nearest ancestor whose rank is valid.
\item For each retained vertex, determine its retained parent.
\item Build a new directed graph containing only retained vertices and
edges between them.
\item Preserve all vertex attributes for retained vertices.
\item Store \code{parent_taxid} and \code{child_taxid} as edge attributes
in the reduced graph.
}
}
\examples{
library(igraph)

# Tiny toy taxonomy:
edges <- data.frame(
  from = c("1","2","2","3","3","4"),
  to   = c("2","3","4","5","6","7")
)

ranks <- data.frame(
  name = as.character(1:7),
  rank = c("R","F","G","G","S","S","S")
)

g <- graph_from_data_frame(edges, directed = TRUE, vertices = ranks)

# Collapse to Family (F) and Species (S)
g_red <- collapse_taxonomy_to_ranks(g, valid_ranks = c("S","F"))

V(g_red)$name
E(g_red)$parent_taxid
E(g_red)$child_taxid

}
