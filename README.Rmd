---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# krakenR <img src="man/figures/logo.png" align="right" height="138" alt="" />

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

The goal of krakenR is to simplify cohort-analysis of sample analysed with the kraken2 taxonomic classification system

## Installation

You can install the development version of krakenR from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("selkamand/krakenR")
```

## Quick Start

```{r}
library(krakenR)

# Read in all kraken reports from a directory into a data.frame
kreport_dir <- system.file(package="krakenR", "simulated_data/simulated_kraken_reports_inc_zero_counts/")
df_kreports <- kraken_reports_parse(kreport_dir)

# Print Data
df_kreports
```

## Taxonomy

A lot of downstream functions (including visualisations) will require taxonomy information. 

This can be read from 'ktaxoonomy.tsv' files present in Langmead et al. precompiled Kraken databases (>2023) or generated for any kraken database using [krakentools](https://github.com/jenniferlu717/KrakenTools?tab=readme-ov-file#make_ktaxonomypy).

Once parsed, this taxonomy object will be used in many other functions

```{r}
path_ktaxonomy <- system.file("example_data/ktaxonomy.tsv", package = "krakenR")
taxonomy <- kraken_taxonomy_parse(path_ktaxonomy)
```


## Visualising Results

```{r}
library(plotly)

sunburst <- kraken_visualise_sunburst(
  df_kreports, 
  taxonomy = taxonomy, 
  sample = "e_coli_1", 
  # ranks = c("S", "G", "F", "D", "R2"), 
  ancestor = "E. coli\nSample", 
  insidetextorientation = "tangential"
)

sunburst
```

### Custom Visualisations
```{r}
# If building more custom visualisations you may need to annotate the kraken datasets with their 'parent' species. You can do this using the kraken_annotate_parents commands
ranks_of_interest <- c("S", "G", "F")
df_kreports_annotated <- df_kreports |>
  filter(Rank %in% ranks_of_interest) |>
  kraken_annotate_parents(
    taxonomy = taxonomy, 
    ancestor = "Ancestor"
  )
```


## Storing as a database


```{r, eval=FALSE}
# Path to folder containing kraken reports 
# (reports must be named with sample_id as prefix)
kreport_dir <- system.file(package="krakenR", "simulated_data/simulated_kraken_reports_inc_zero_counts/")

# Create kraken sqlite database
kraken_db <- kraken_reports_parse_to_sqlite_db(kreport_dir)
```

